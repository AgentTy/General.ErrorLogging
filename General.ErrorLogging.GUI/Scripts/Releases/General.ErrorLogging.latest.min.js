(function(n){function u(t,i,r,u,f,e){var o=new ErrorLogger.EventContextModel(t,i,r);o.Details=u;o.ShouldNotifyListener=e;f&&(ErrorLogger.AppContext.CustomID=f);try{ErrorLogger.ReportEvent(o)}catch(s){typeof console!="undefined"&&n.DoConsole&&console.log(s)}}function o(t,i,r,u,e){var o;o=typeof e!="undefined"&&e!=null?ErrorLogger.ReadError(e):ErrorLogger.EventContextModel(t,ErrorLogger.EventTypes.Javascript);o.ShouldNotifyListener=!0;try{r&&(o.LineNumber=parseInt(r));u&&(o.ColumnNumber=parseInt(u))}catch(s){typeof console!="undefined"&&n.DoConsole&&console.log(s)}try{if(o.FileName=l(i),o.FileName.indexOf("General.ErrorLogging.js")>-1){if(f++,f>1)return}else f=0}catch(s){typeof console!="undefined"&&n.DoConsole&&console.log(s)}try{ErrorLogger.ReportEvent(o)}catch(s){typeof console!="undefined"&&n.DoConsole&&console.log(s)}}function h(){s=setInterval(function(){ErrorLogger.LoadFilters()},ErrorLogger.PollingInterval)}function b(){clearInterval(s)}function c(t,i,r,u){jQuery.support.cors=!0;$.ajax({type:"POST",url:ErrorLogger.APIEndpoint+t,data:JSON.stringify(i),dataType:"json",contentType:"application/json; charset=utf-8",timeout:2e4,success:function(n,t,i){r&&r(n,t,i)},error:function(t,i,r){typeof console!="undefined"&&n.DoConsole&&console.log("Could not post to ErrorLogging database: "+t.status+" "+t.statusText+"\r\n"+t.responseText);u&&u(t,i,r)}})}function l(n){try{var r=n.replace("http://","").replace("https://","").split("/"),t="";for(i=1;i<r.length;i++)t+="/",t+=r[i];return t==""&&(t="/"),t}catch(u){return n}}function k(n){var i,t=n.match(/\((.*?)\)\n/),r,u;if(t&&t.length>0?i=t[0].substr(1,t[0].length-3):(t=n.match(/^@(.*?)\n/),t&&t.length>0?i=t[0].substr(1,t[0].length-2):(t=n.match(/^http(.*?)\n/),t&&t.length>0&&(i=t[0]))),t=n.match(/.*at [^\s]*/),t&&t.length>0&&(u=t[0].indexOf("at ")+3,r=t[0].substr(u,t[0].length-u)),i){var f=l(i).split(":"),e=f[0],o=f[1],s=f[2];return{MethodName:r,FileInfo:i,FileName:e,LineNumber:o,ColumnNumber:s}}return{MethodName:r,FileInfo:null,FileName:null,LineNumber:null,ColumnNumber:null}}function d(){var u={Last:null,History:[]},i=null;if(n.LocalHistoryEnabled){if(r){i=localStorage.getItem(t);try{i=i?JSON.parse(i):null}catch(f){i=null;typeof console!="undefined"&&n.DoConsole&&console.log(f)}if(i&&typeof i.History!="undefined"){n.EventHistory=i;return}}i=it(t);try{i=i?JSON.parse(i):u}catch(f){i=u;typeof console!="undefined"&&n.DoConsole&&console.log(f)}i&&typeof i.History=="undefined"?i=u:i&&i.Last&&typeof i.Last.Name=="undefined"&&(i=nt(i))}n.EventHistory=i?i:u}function a(i,u){!r&&u&&u.length>60?u=u.substr(0,57)+"...":r&&u&&u.length>300&&(u=u.substr(0,297)+"...");var f={IC:i,Name:u,Time:new Date};n.EventHistory.Last=f;n.EventHistory.History.unshift(f);n.EventHistory.History.length>(r?n.LocalHistoryMax:n.LocalHistoryMax/2)&&n.EventHistory.History.pop();n.LocalHistoryEnabled&&(r?(localStorage.setItem(t,JSON.stringify(n.EventHistory)),v(t,JSON.stringify(g(n.EventHistory)),n.HistoryCookieDays)):v(t,JSON.stringify(n.EventHistory),n.HistoryCookieDays))}function g(n){var t={Last:null,History:[]};return $.each(n.History,function(i){var r=n.History[i];t.History.push(r.IC);n.Last&&(t.Last=n.Last.IC)}),t}function nt(n){var t={Last:null,History:[]};return t.Last={IC:n.Last,Name:null,Time:null},$.each(n.History,function(i){var r=n.History[i];t.History.push({IC:r,Name:null,Time:null})}),t}function tt(){var n="testls321";try{return localStorage.setItem(n,n),localStorage.removeItem(n),!0}catch(t){return!1}}function it(n,t){return t=document.cookie.match("(^|;)\\s*"+n+"\\s*=\\s*([^;]+)"),t?decodeURIComponent(t.pop()):""}function v(t,i,r){var u,f,e;r?(u=new Date,u.setTime(u.getTime()+r*864e5),f="; expires="+u.toGMTString()):f="";e=t+"="+encodeURIComponent(i)+f+"; path=/";e+=n.CookieDomain?"; domain=."+n.CookieDomain+"; path=/":"; path=/";document.cookie=e}var y="/api/[AppID]/ErrorLog/RecordEvent/",p="/api/[AppID]/LoggingFilter/ActiveFiltersInContext",w="/Lookup?IC=[IncidentCode]",t="GenErrLogHist",e="",r=tt(),f,s;n.DoConsole=!0;n.LocalHistoryEnabled=!0;n.LocalHistoryMax=30;n.CookieDomain=null;n.HistoryCookieDays=60;n.PollingInterval=3e5;n.APIEndpoint=null;n.APIActionPath_RecordEvent=null;n.APIActionPath_GetFilters=null;n.LastEvent=null;n.EventHistory=null;n.Active=!1;n.Filters=null;n.Listener=null;n.EventTypes={Server:"Server",SQL:"SQL",SQLConnectivity:"SQLConnectivity",SQLTimeout:"SQLTimeout",Javascript:"Javascript",Warning:"Warning",Audit:"Audit",Trace:"Trace",Auth:"Auth",Properties:{Server:{Name:"Server",Value:1,Description:"Managed Code errors and other server side exceptions"},SQL:{Name:"SQL",Value:2,Description:"SQL Server errors"},SQLConnectivity:{Name:"SQL Connectivity",Value:3,Description:"SQL Server connectivity errors"},SQLTimeout:{Name:"SQL Timeout",Value:4,Description:"SQL Server timeouts"},Javascript:{Name:"Javascript",Value:6,Description:"Client side javascript errors"},Warning:{Name:"Warning",Value:10,Description:"A warning level trace record"},Audit:{Name:"Audit",Value:11,Description:"An audit level trace record"},Trace:{Name:"Trace",Value:12,Description:"A trace record"},Auth:{Name:"Auth",Value:13,Description:"An authentication event"}}};n.SeverityTypes={Low:1,Normal:5,High:10,Properties:{1:{Name:"Low Severity",Value:1,Description:"Low Severity Event"},5:{Name:"Normal Severity",Value:5,Description:"Normal Severity Event"},10:{Name:"High Severity",Value:10,Description:"High Severity Event"}}};n.AppContextModel=function(n,t,i){return{ClientID:null,UserType:null,UserID:null,CustomID:null,Custom1:null,Custom2:null,Custom3:null,AppID:n,AppName:t,Environment:i,Validate:function(n){n||(n=this);var t="",i=!0;return(!n.AppID&&n.AppID!=0||isNaN(n.AppID))&&(t+="AppContext.AppID is invalid. ",i=!1),n.Environment||(t+="AppContext.Environment is null. ",i=!1),/dev|1|qa|2|stage|3|customenv|4|live|5/.test(n.Environment.toLowerCase())||(t+="AppContext.Environment is invalid. ",i=!1),{isValid:i,detail:t}}}};n.AppContext=n.AppContextModel();n.EventContextModel=function(n,t,i){return{EventType:t,Severity:i,ErrorCode:null,EventName:n,ExceptionType:null,MethodName:null,FileName:null,LineNumber:0,ColumnNumber:0,URL:window.location.href,UserAgent:navigator.userAgent,Details:null,Duration:null,ShouldNotifyListener:!1,SavedToDatabase:!1,IncidentCode:null,Validate:function(n){n||(n=this);var t="",i=!0;return n.EventName||(t+="Event Name is required",i=!1),{isValid:i,detail:t}}}};n.RegisterApplication=function(n,t,i){n&&(n=n.replace(/\/+$/,""));this.APIEndpoint=n;e=t;this.AppContext=i;var r=this.Ready();if(r.isReady)this.APIActionPath_RecordEvent=y.replace("[AppID]",this.AppContext.AppID),this.APIActionPath_GetFilters=p.replace("[AppID]",this.AppContext.AppID),this.LoadFilters(),h();else throw new Error(r.detail+" Event Logging cannot be started until a valid API Endpoint and Application Context have been set.");};n.ListenGlobal=function(n){var t=this.Ready();if(t.isReady)window.onerror=o,this.Listener=n,this.Active=!0;else throw new Error(t.detail+" Event Logging cannot be started until a valid API Endpoint and Application Context have been set via ErrorLogger.RegisterApplication.");};n.Pause=function(){window.onerror=null;b();this.Active=!1};n.Resume=function(){window.onerror=o;h();this.Active=!0};n.Ready=function(){var t="",i=!0,n;return this.APIEndpoint||(t+="APIEndpoint is invalid. ",i=!1),this.AppContext||(t+="AppContext is null. ",i=!1),this.AppContext&&this.AppContext.Validate?(n=this.AppContext.Validate(),n.isValid||(t+=n.detail+"AppContext is invalid. ",i=!1)):this.AppContext&&!this.AppContext.Validate&&(n=this.AppContextModel().Validate(this.AppContext),n.isValid||(t+=n.detail+"AppContext is invalid. ",i=!1)),{isReady:i,detail:t}};n.ReportError=function(n,t,i,r,f){u(n,ErrorLogger.EventTypes.Javascript,t,i,r,f)};n.ReportWarning=function(n,t,i,r){u(n,ErrorLogger.EventTypes.Warning,t,i,r,!1)};n.ReportAudit=function(n,t,i,r){u(n,ErrorLogger.EventTypes.Audit,t,i,r,!1)};n.ReportTrace=function(n,t,i,r){u(n,ErrorLogger.EventTypes.Trace,t,i,r,!1)};n.ReportEvent=function(n){var t=ErrorLogger.ShouldStoreEvent(n);t.IShouldStoreEvent&&ErrorLogger.StoreEvent(n,t)};f=0;n.ReadError=function(n){var t,i;if(n!=null&&typeof n!="undefined"&&typeof n.message!="undefined"){if(t=new ErrorLogger.EventContextModel(n.message,ErrorLogger.EventTypes.Javascript),n.name&&(t.ExceptionType=n.name),t.Details="",n.stack){t.Details+="Stack: "+n.stack+"\r\n";try{i=k(n.stack);i&&(i.MethodName&&(t.MethodName=i.MethodName),i.FileName&&(t.FileName=i.FileName),i.LineNumber&&(t.LineNumber=i.LineNumber),i.ColumnNumber&&(t.ColumnNumber=i.ColumnNumber))}catch(r){}}n.description&&n.description!=t.EventName&&(t.Details+="Description: "+n.description+"\r\n");n.toSource&&(t.Details+="\r\n\r\nSource: "+n.toSource()+"\r\n");n.toString&&(t.Details+="\r\n\r\n "+n.toString()+"\r\n")}else t=new ErrorLogger.EventContextModel(n,ErrorLogger.EventTypes.Javascript);return t};n.ShouldStoreEvent=function(n){if(ErrorLogger.Filters&&ErrorLogger.Filters.length>0){var t=!1,i=[];return $.each(ErrorLogger.Filters,function(r,u){if(u.EventFilter.all)t=!0,i.push(u.ID);else if(u.EventFilter.events&&u.EventFilter.events.length>0)for(var f=0;f<u.EventFilter.events.length;f++)u.EventFilter.events[f]==n.EventType&&(t=!0,i.push(u.ID))}),{IShouldStoreEvent:t,MatchedFilters:i}}return{IShouldStoreEvent:!0,MatchedFilters:[]}};n.StoreEvent=function(t,i){try{t.UserAgent||(t.UserAgent=navigator.userAgent);t.URL||(t.URL=window.location.href)}catch(r){typeof console!="undefined"&&n.DoConsole&&console.log(r)}try{c(ErrorLogger.APIActionPath_RecordEvent,{AccessCode:e,EventContext:t,AppContext:ErrorLogger.AppContext,FilterContext:i},function(n){n.Success?(t.SavedToDatabase=!0,t.IncidentCode=n.IncidentCode,a(n.IncidentCode,t.EventName)):(t.SavedToDatabase=!1,console.log("An attempt was made to report an issue with this application but did not succeed due to a server side error."),a("unknown",t.EventName));ErrorLogger.LastEvent=t;ErrorLogger.Listener&&t.ShouldNotifyListener&&ErrorLogger.Listener(t)},function(){typeof console!="undefined"&&n.DoConsole&&console.log("An attempt was made to report an issue with this application but did not succeed due to a communication error.")})}catch(r){console.log("An attempt was made to report an issue with this application but did not succeed. ("+r.name+")")}};n.LoadFilters=function(){c(ErrorLogger.APIActionPath_GetFilters,{AccessCode:e,AppContext:ErrorLogger.AppContext},function(n){ErrorLogger.Filters=n},function(){typeof console!="undefined"&&n.DoConsole&&console.log("Unable to load error logging filters")})};n.DisplayHistory=function(t){var r=0,u="tblGenErrLocalHistory",i=$('<table id="'+u+'"> <thead> <tr> <td colspan="3">Recent javascript errors/events recorded for this browser on this site are listed here. *requires cookies<\/td><\/tr><tr> <td>Time (local)<\/td><td>Incident Code<\/td><td>Name<\/td><\/tr><\/thead> <tbody> <\/tbody> <\/table>'),f=i.find("tbody")[0];return n.EventHistory&&n.EventHistory.History.length>0?(r=n.EventHistory.History.length,$.each(n.EventHistory.History,function(t){var i=n.EventHistory.History[t],r=$("<tr>"),u;i.Time?(u=new Date(i.Time),$("<td>").text(u.toLocaleDateString()+" "+u.toLocaleTimeString()).appendTo(r)):$("<td>").text("unknown").appendTo(r);i.IC!="unknown"&&n.APIEndpoint?$("<a>").attr("href",n.APIEndpoint+w.replace("[IncidentCode]",i.IC)).text(i.IC).appendTo($("<td>").appendTo(r)):$("<td>").text(i.IC).appendTo(r);i.Name?$("<td>").text(decodeURIComponent(i.Name)).appendTo(r):$("<td>").text("unknown").appendTo(r);r.appendTo(f)})):$('<tr> <td colspan="3">No events found, cookie expires after '+n.HistoryCookieDays+" days<\/td> <\/tr>").appendTo(f),$("#"+u).remove(),t?i.appendTo(t):i.appendTo($("body")[0]),r};d()})(this.ErrorLogger=this.ErrorLogger||{});
//# sourceMappingURL=General.ErrorLogging.min.js.map
